<!doctype html>
<html>
<body>
<script>
window.addEventListener('message', (ev) => {
  if (!ev.data || ev.data.action !== 'download') return;

  // Create a simple text blob and trigger download
  const content = 'This is a test file from the iframe origin: ' + location.origin + '\\n' + new Date().toISOString();
  const b = new Blob([content], { type: 'text/plain' });
  const url = URL.createObjectURL(b);

  const a = document.createElement('a');
  a.href = url;
  // give a filename so the Save dialog shows something
  a.download = 'iframe-origin-test.txt';
  // open in same browsing context to avoid popup blockers
  document.body.appendChild(a);
  // click to start download (user gesture proxied from top-level)
  a.click();

  // cleanup
  setTimeout(() => {
    URL.revokeObjectURL(url);
    document.body.removeChild(a);
    parent.postMessage({ status: 'download-initiated', origin: location.origin }, '*');
  }, 1000);
});
</script>
</body>
</html>
